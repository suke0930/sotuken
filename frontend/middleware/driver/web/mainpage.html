<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Server Manager - Enhanced</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.js"></script>
    <style>
        :root {
            /* Light Mode Colors */
            --light-primary: #E7A930;
            --light-secondary: #A4C013;
            --light-accent: #6200EE;
            --light-highlight: #E7A930;
            
            /* Dark Mode Colors */
            --dark-primary: #E6BC43;
            --dark-secondary: #BDDB0B;
            --dark-accent: #BB86FC;
            --dark-highlight: #E6BC43;
            
            /* Theme Variables (default to light) */
            --theme-primary: var(--light-primary);
            --theme-secondary: var(--light-secondary);
            --theme-accent: var(--light-accent);
            --theme-highlight: var(--light-highlight);
            --theme-bg: #f8fafc;
            --theme-surface: #ffffff;
            --theme-text: #1f2937;
            --theme-text-secondary: #6b7280;
            --theme-border: #e5e7eb;
            --theme-shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --theme-primary: var(--dark-primary);
            --theme-secondary: var(--dark-secondary);
            --theme-accent: var(--dark-accent);
            --theme-highlight: var(--dark-highlight);
            --theme-bg: #0f0f0f;
            --theme-surface: #1a1a1a;
            --theme-text: #ffffff;
            --theme-text-secondary: #b3b3b3;
            --theme-border: #2d2d2d;
            --theme-shadow: rgba(0, 0, 0, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: var(--theme-bg);
            min-height: 100vh;
            color: var(--theme-text);
            font-size: 15px;
            line-height: 1.7;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background 0.3s ease, color 0.3s ease;
        }

        #app {
            min-height: 100vh;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            background: var(--theme-surface);
            border: 2px solid var(--theme-border);
            font-size: 16px;
            color: var(--theme-primary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px var(--theme-shadow);
        }

        .theme-toggle:hover {
            background: var(--theme-primary);
            color: white;
            border-color: var(--theme-primary);
            transform: scale(1.05);
        }

        /* User Menu Dropdown */
        .user-menu-container {
            position: relative;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 12px;
            background: var(--theme-surface);
            border: 1px solid var(--theme-border);
            border-radius: 8px;
            color: var(--theme-text);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .user-menu:hover {
            background: var(--theme-border);
        }

        .user-menu-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--theme-surface);
            border: 1px solid var(--theme-border);
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--theme-shadow);
            min-width: 200px;
            padding: 8px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }

        .user-menu-container.open .user-menu-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-menu-item {
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--theme-text);
            text-decoration: none;
            font-size: 14px;
        }

        .user-menu-item:hover {
            background: var(--theme-border);
        }

        .user-menu-item i {
            width: 16px;
            font-size: 14px;
            text-align: center;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            width: 280px;
            height: calc(100vh - 70px);
            background: var(--theme-surface);
            box-shadow: 2px 0 10px var(--theme-shadow);
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 999;
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-overlay {
            position: fixed;
            top: 70px;
            left: 0;
            width: 100%;
            height: calc(100vh - 70px);
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 998;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-menu-item {
            margin: 0;
        }

        .sidebar-menu-button {
            width: 100%;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--theme-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
            border-left: 3px solid transparent;
        }

        .sidebar-menu-button:hover {
            background: var(--theme-border);
            border-left-color: var(--theme-primary);
        }

        .sidebar-menu-button.active {
            background: var(--theme-primary);
            color: white;
            border-left-color: var(--theme-primary);
        }

        .sidebar-menu-button i {
            font-size: 14px;
            width: 18px;
        }

        /* Hamburger Menu Button */
        .hamburger-menu {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--theme-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            width: 36px;
            height: 36px;
        }

        .hamburger-menu:hover {
            background: var(--theme-border);
        }

        /* Download Progress Overlay */
        .download-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--theme-surface);
            box-shadow: 0 -4px 20px var(--theme-shadow);
            padding: 24px;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            border-top: 4px solid var(--theme-primary);
        }

        .download-overlay.active {
            transform: translateY(0);
        }

        .download-overlay-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .download-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .download-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--theme-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .download-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--theme-text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            transition: color 0.2s;
        }

        .download-close:hover {
            color: #ef4444;
        }

        .download-info {
            margin-bottom: 12px;
        }

        .download-filename {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .download-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #374151;
        }

        .download-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .download-progress-wrapper {
            position: relative;
            width: 100%;
            height: 8px;
            background: var(--theme-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .download-progress-fill {
            height: 100%;
            background: var(--theme-primary);
            transition: width 0.3s ease;
            position: relative;
        }

        .download-percentage {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: var(--theme-text-secondary);
            font-weight: 500;
            font-size: 12px;
            white-space: nowrap;
        }

        .download-percentage-static {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: var(--theme-text-secondary);
            font-weight: 500;
            font-size: 12px;
        }

        .download-status {
            text-align: center;
            color: var(--theme-primary);
            font-size: 14px;
            font-weight: 600;
        }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-accent) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auth Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: var(--theme-surface);
            border-radius: 20px;
            box-shadow: 0 25px 50px var(--theme-shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: var(--theme-text);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .auth-header p {
            color: var(--theme-text-secondary);
            font-size: 16px;
        }

        .auth-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-accent) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 32px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--theme-text);
            font-size: 13px;
        }

        label i {
            font-size: 12px;
            margin-right: 4px;
        }

        input[type="text"],
        input[type="password"],
        select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--theme-border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--theme-surface);
            color: var(--theme-text);
            transition: all 0.2s ease;
            outline: none;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        select:focus {
            border-color: var(--theme-primary);
            box-shadow: 0 0 0 2px rgba(230, 188, 67, 0.15);
        }

        select:disabled {
            background: var(--theme-border);
            color: var(--theme-text-secondary);
            cursor: not-allowed;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 18px;
            border: 1px solid transparent;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 38px;
        }

        .btn-primary {
            background: var(--theme-primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--theme-highlight);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px var(--theme-shadow);
        }

        .btn-secondary {
            background: var(--theme-surface);
            color: var(--theme-text);
            border-color: var(--theme-border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--theme-border);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }

        .btn-success {
            background: var(--theme-primary);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
            min-height: 32px;
        }

        /* Message Styles */
        .message {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 16px;
        }

        .message.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .message-area {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
        }

        .message-area.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .message-area.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        /* Transitions */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }

        /* Main Wrapper */
        .main-wrapper {
            min-height: 100vh;
            background: var(--theme-bg);
            transition: background 0.3s ease;
        }

        /* Navbar */
        .navbar {
            background: var(--theme-surface);
            box-shadow: 0 1px 3px var(--theme-shadow);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background 0.3s ease;
        }

        .navbar-content {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: var(--theme-text);
            letter-spacing: -0.3px;
        }

        .navbar-brand i {
            color: var(--theme-primary);
            font-size: 16px;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            background: var(--theme-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 12px;
        }

        /* Dashboard */
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px 100px;
            transition: padding 0.3s ease;
        }

        .dashboard.sidebar-open {
            margin-left: 280px;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--theme-text);
            margin-bottom: 6px;
            letter-spacing: -0.5px;
        }

        .dashboard-subtitle {
            color: var(--theme-text-secondary);
            font-size: 14px;
            font-weight: 400;
        }

        /* Tab Navigation - Hidden, moved to sidebar */
        .tab-nav {
            display: none;
        }

        /* Content Sections */
        .content-section {
            background: var(--theme-surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px var(--theme-shadow);
            transition: background 0.3s ease;
            border: 1px solid var(--theme-border);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--theme-text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.3px;
        }

        .section-title i {
            font-size: 16px;
        }

        /* Server Cards */
        .servers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .server-card {
            background: var(--theme-surface);
            border: 1px solid var(--theme-border);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s ease;
            position: relative;
        }

        .server-card:hover {
            border-color: var(--theme-primary);
            box-shadow: 0 2px 8px var(--theme-shadow);
        }

        .server-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .server-status.running {
            background: #d1fae5;
            color: #065f46;
        }

        .server-status.stopped {
            background: #fef2f2;
            color: #991b1b;
        }

        .server-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--theme-text);
            margin-bottom: 12px;
        }

        .server-name i {
            font-size: 14px;
            margin-right: 6px;
        }

        .server-details {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .server-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .server-detail-label {
            color: var(--theme-text-secondary);
            font-size: 13px;
            font-weight: 400;
        }

        .server-detail-label i {
            font-size: 12px;
            margin-right: 4px;
        }

        .server-detail-value {
            color: var(--theme-text);
            font-weight: 500;
            font-size: 13px;
        }

        .server-actions {
            display: flex;
            gap: 8px;
        }

        /* Form Layouts */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--theme-text-secondary);
        }

        .empty-state i {
            font-size: 48px;
            color: var(--theme-border);
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--theme-text);
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
            color: var(--theme-text-secondary);
        }

        /* Download Manager Styles */
        .connection-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .connection-badge.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-badge.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .download-list-preview {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin-top: 15px;
        }

        .download-list-preview pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .download-version-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .download-version-btn {
            padding: 12px;
            background: var(--theme-surface);
            border: 2px solid var(--theme-primary);
            color: var(--theme-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .download-version-btn:hover {
            background: var(--theme-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        .download-version-btn.selected {
            background: var(--theme-primary);
            color: white;
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        .download-selected-file-card {
            margin-top: 20px;
            padding: 20px;
            background: var(--theme-surface);
            border: 2px solid var(--theme-primary);
            border-radius: 8px;
        }

        .download-selected-file-card h4 {
            margin: 0 0 10px 0;
            color: var(--theme-text);
            font-size: 1.1rem;
        }

        .download-selected-file-card p {
            margin: 8px 0;
            color: var(--theme-text-secondary);
        }

        .download-selected-file-name {
            font-weight: 600;
            color: var(--theme-primary);
            font-size: 1.05rem;
        }

        .download-selected-file-url {
            font-size: 0.85rem;
            color: var(--theme-text-secondary);
            word-break: break-all;
            font-family: 'Courier New', monospace;
        }

        .download-card {
            background: var(--theme-surface);
            border: 2px solid var(--theme-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .download-card:hover {
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        .download-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .download-filename {
            font-weight: 600;
            color: var(--theme-text);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .download-status-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .download-status-badge.status-downloading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .download-status-badge.status-completed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .download-status-badge.status-error,
        .download-status-badge.status-cancelled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .download-progress-container {
            width: 100%;
            height: 8px;
            background: var(--theme-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .download-progress-bar {
            height: 100%;
            background: var(--theme-primary);
            transition: width 0.3s ease;
        }

        .download-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .download-info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .download-info-label {
            font-size: 0.85rem;
            color: var(--theme-text-secondary);
            font-weight: 500;
        }

        .download-info-value {
            font-size: 0.95rem;
            color: var(--theme-text);
            font-weight: 600;
        }

        .download-section {
            margin-bottom: 20px;
            padding: 18px;
            background: var(--theme-bg);
            border-radius: 6px;
            border-left: 3px solid var(--theme-primary);
        }

        .download-section h3 {
            color: var(--theme-text);
            margin-bottom: 12px;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .download-section h3 i {
            font-size: 14px;
        }

        .download-control-group {
            margin-bottom: 15px;
        }

        .download-control-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--theme-text);
            font-weight: 600;
        }

        .download-control-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard.sidebar-open {
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .servers-grid {
                grid-template-columns: 1fr;
            }

            .download-version-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .download-info-grid {
                grid-template-columns: 1fr;
            }

            .download-stats {
                flex-direction: column;
                gap: 8px;
            }

            .navbar-content {
                padding: 0 10px;
            }

            .navbar-brand {
                font-size: 18px;
            }

            .user-menu span {
                display: none;
            }

            .sidebar {
                width: 260px;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const { createApp } = Vue;

        // Server software name mapping (form value -> API name)
        const SERVER_NAME_MAP = {
            'vanilla': 'Vanilla',
            'forge': 'Forge',
            'fabric': 'Fabric',
            'paper': 'Paper'
        };

        createApp({
            data() {
                return {
                    loading: true,
                    isAuthenticated: false,
                    authMode: 'login',
                    username: '',
                    
                    darkMode: false,
                    sidebarOpen: false,
                    userMenuOpen: false,
                    
                    signupForm: { id: '', password: '' },
                    loginForm: { id: '', password: '' },
                    authMessage: '',
                    authMessageType: 'error',
                    
                    activeTab: 'servers',
                    tabs: [
                        { id: 'servers', label: 'サーバー一覧', icon: 'fas fa-server' },
                        { id: 'create', label: '新規作成', icon: 'fas fa-plus-circle' },
                        { id: 'settings', label: 'システム設定', icon: 'fas fa-cogs' },
                        { id: 'downloads', label: 'ダウンロード管理', icon: 'fas fa-cloud-download-alt' }
                    ],
                    sidebarMenu: [
                        { id: 'servers', label: 'サーバー一覧', icon: 'fas fa-server' },
                        { id: 'create', label: '新規作成', icon: 'fas fa-plus-circle' },
                        { id: 'settings', label: 'システム設定', icon: 'fas fa-cogs' },
                        { id: 'downloads', label: 'ダウンロード管理', icon: 'fas fa-cloud-download-alt' },
                        { id: 'about', label: 'About Us', icon: 'fas fa-info-circle' },
                        { id: 'tutorials', label: 'Tutorials', icon: 'fas fa-book' }
                    ],
                    
                    errorMessage: '',
                    successMessage: '',
                    
                    servers: [],
                    serversLoading: false,
                    editingServer: null,
                    serverForm: {
                        serverName: '',
                        minecraftVersion: '',
                        serverSoftware: '',
                        jdkVersion: ''
                    },
                    formSubmitting: false,
                    
                    // Step-by-step form data
                    serverListData: null,
                    availableVersions: [],
                    loadingVersions: false,
                    
                    apiResponse: 'APIテストボタンをクリックしてください...',
                    
                    wsConnected: false,
                    ws: null,
                    downloadListType: '',
                    downloadListData: null,
                    fetchingList: false,
                    selectedFile: null,
                    startingDownload: false,
                    activeDownloads: [],
                    
                    // New download progress state for server creation
                    downloadActive: false,
                    downloadProgress: {
                        filename: '',
                        percentage: 0,
                        downloadedMB: 0,
                        totalMB: 0,
                        speed: 0,
                        status: ''
                    }
                };
            },

            async mounted() {
                // Load saved theme preference
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    this.darkMode = true;
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    this.darkMode = false;
                    document.documentElement.setAttribute('data-theme', 'light');
                }
                
                // Close user menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-menu-container')) {
                        this.userMenuOpen = false;
                    }
                });
                
                // Fetch server list data
                await this.fetchServerList();
                
                await this.checkAuth();
                this.connectWebSocket();
            },

            beforeUnmount() {
                if (this.ws) {
                    this.ws.close();
                }
            },

            computed: {
                minecraftVersionPlaceholder() {
                    if (!this.serverForm.serverSoftware) {
                        return 'まずサーバーソフトウェアを選択してください';
                    }
                    if (!this.serverListData) {
                        return 'サーバーリストを読み込み中...';
                    }
                    if (this.loadingVersions) {
                        return '読み込み中...';
                    }
                    if (this.availableVersions.length === 0 && this.serverListData) {
                        return 'バージョンが見つかりません';
                    }
                    return 'バージョンを選択してください';
                }
            },

            watch: {
                'serverForm.serverSoftware'(newValue, oldValue) {
                    // Reset version and JDK when software changes
                    this.serverForm.minecraftVersion = '';
                    this.serverForm.jdkVersion = '';
                    this.availableVersions = [];
                    
                    // If software is selected, fetch available versions
                    if (newValue) {
                        if (this.serverListData) {
                            this.loadAvailableVersions(newValue);
                        } else {
                            // If serverListData is not loaded yet, wait for it
                            // fetchServerList will handle loading versions when data arrives
                        }
                    }
                },
                
                'serverForm.minecraftVersion'(newValue) {
                    // Auto-select JDK based on selected version
                    if (newValue && this.availableVersions.length > 0) {
                        const selectedVersion = this.availableVersions.find(v => v.version === newValue);
                        if (selectedVersion) {
                            this.serverForm.jdkVersion = `OpenJDK ${selectedVersion.jdk}`;
                        }
                    } else {
                        this.serverForm.jdkVersion = '';
                    }
                },
                
                serverListData(newValue) {
                    // When serverListData loads, if software is already selected, load its versions
                    if (newValue && this.serverForm.serverSoftware) {
                        this.loadAvailableVersions(this.serverForm.serverSoftware);
                    }
                }
            },

            methods: {
                toggleTheme() {
                    this.darkMode = !this.darkMode;
                    if (this.darkMode) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                        localStorage.setItem('theme', 'light');
                    }
                },

                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                },

                closeSidebar() {
                    this.sidebarOpen = false;
                },

                toggleUserMenu() {
                    this.userMenuOpen = !this.userMenuOpen;
                },

                closeUserMenu() {
                    this.userMenuOpen = false;
                },

                async checkAuth() {
                    try {
                        const response = await fetch('/user/auth', {
                            credentials: 'include'
                        });
                        const data = await response.json();
                        
                        if (data.ok) {
                            this.isAuthenticated = true;
                            this.username = data.userId;
                            await this.loadServers();
                        } else if (data.reason === 'no_user_registered') {
                            this.authMode = 'signup';
                        } else {
                            this.authMode = 'login';
                        }
                    } catch (error) {
                        console.error('Auth check failed:', error);
                        this.authMode = 'login';
                    } finally {
                        this.loading = false;
                    }
                },

                async handleSignup() {
                    try {
                        console.log('Attempting signup with:', this.signupForm);
                        
                        const response = await fetch('http://127.0.0.1:12800/user/signup', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json','Access-Control-Allow-Origin':'*'},
                            credentials: 'include',
                            body: JSON.stringify({id:this.signupForm.id,password:this.signupForm.password})
                        });
                        
                        console.log('Signup response status:', response.status);

                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            const text = await response.text();
                            console.error('Non-JSON response:', text.substring(0, 200));
                            this.authMessage = `サーバーエラーが発生しました (Status: ${response.status})`;
                            this.authMessageType = 'error';
                            return;
                        }

                        const data = await response.json();
                        console.log('Signup response data:', data);
                        
                        if (data.ok) {
                            this.authMessage = '登録が完了しました!';
                            this.authMessageType = 'success';
                            setTimeout(() => {
                                this.isAuthenticated = true;
                                this.username = this.signupForm.id;
                                this.loadServers();
                            }, 1000);
                        } else {
                            this.authMessage = data.message || '登録に失敗しました';
                            this.authMessageType = 'error';
                        }
                    } catch (error) {
                        console.error('Signup error:', error);
                        this.authMessage = `エラーが発生しました: ${error.message}`;
                        this.authMessageType = 'error';
                    }
                },

                async handleLogin() {
                    try {
                        const response = await fetch('/user/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        const data = await response.json();
                        
                        if (data.ok) {
                            this.authMessage = 'ログインしました!';
                            this.authMessageType = 'success';
                            setTimeout(() => {
                                this.isAuthenticated = true;
                                this.username = this.loginForm.id;
                                this.loadServers();
                            }, 500);
                        } else {
                            this.authMessage = data.message || 'ログインに失敗しました';
                            this.authMessageType = 'error';
                        }
                    } catch (error) {
                        this.authMessage = 'エラーが発生しました';
                        this.authMessageType = 'error';
                    }
                },

                async handleLogout() {
                    try {
                        await fetch('/user/logout', { 
                            method: 'POST',
                            credentials: 'include'
                        });
                        this.userMenuOpen = false;
                        this.isAuthenticated = false;
                        this.authMode = 'login';
                        this.servers = [];
                        this.loginForm = { id: '', password: '' };
                    } catch (error) {
                        console.error('Logout failed:', error);
                    }
                },

                async loadServers() {
                    this.serversLoading = true;
                    try {
                        const response = await fetch('/api/servers', {
                            credentials: 'include'
                        });
                        
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            const text = await response.text();
                            console.error('Non-JSON response:', text);
                            this.showError('サーバーが予期しない形式の応答を返しました');
                            this.serversLoading = false;
                            return;
                        }
                        
                        const data = await response.json();
                        
                        if (data.ok) {
                            setTimeout(() => {
                                this.servers = data.servers || [];
                                this.serversLoading = false;
                            }, 300);
                        } else {
                            this.showError('サーバー一覧の取得に失敗しました');
                            this.serversLoading = false;
                        }
                    } catch (error) {
                        console.error('Load servers error:', error);
                        this.showError(`サーバー一覧の取得中にエラーが発生しました: ${error.message}`);
                        this.serversLoading = false;
                    }
                },

                async fetchServerList() {
                    try {
                        const response = await fetch('http://localhost:3000/api/list/servers');
                        const data = await response.json();
                        
                        if (data.success && data.data) {
                            this.serverListData = data.data;
                            // If server software is already selected, load its versions
                            if (this.serverForm.serverSoftware) {
                                this.loadAvailableVersions(this.serverForm.serverSoftware);
                            }
                        } else {
                            console.error('Failed to fetch server list:', data);
                        }
                    } catch (error) {
                        console.error('Error fetching server list:', error);
                        // Don't show error to user, just log it
                    }
                },

                loadAvailableVersions(serverSoftware) {
                    this.loadingVersions = true;
                    this.availableVersions = [];
                    
                    // Small delay to show loading state
                    setTimeout(() => {
                        if (!this.serverListData) {
                            this.loadingVersions = false;
                            return;
                        }
                        
                        const apiName = SERVER_NAME_MAP[serverSoftware.toLowerCase()];
                        if (!apiName) {
                            this.availableVersions = [];
                            this.loadingVersions = false;
                            return;
                        }
                        
                        const serverData = this.serverListData.find(s => s.name === apiName);
                        if (serverData && serverData.versions) {
                            this.availableVersions = serverData.versions;
                        } else {
                            this.availableVersions = [];
                        }
                        
                        this.loadingVersions = false;
                    }, 100);
                },

                async handleServerSubmit() {
                    this.formSubmitting = true;
                    
                    // Start download simulation for new feature
                    this.startDownloadSimulation();
                    
                    try {
                        if (this.editingServer) {
                            await this.updateServer();
                        } else {
                            await this.createServer();
                        }
                    } finally {
                        this.formSubmitting = false;
                    }
                },

                startDownloadSimulation() {
                    this.downloadActive = true;
                    this.downloadProgress = {
                        filename: `${this.serverForm.serverSoftware}-${this.serverForm.minecraftVersion}.jar`,
                        percentage: 0,
                        downloadedMB: 0,
                        totalMB: 45.8,
                        speed: 0,
                        status: 'ダウンロード中...'
                    };

                    const interval = setInterval(() => {
                        if (this.downloadProgress.percentage >= 100) {
                            clearInterval(interval);
                            this.downloadProgress.status = '完了!';
                            setTimeout(() => {
                                this.downloadActive = false;
                            }, 2000);
                            return;
                        }

                        const increment = Math.random() * 15 + 5;
                        this.downloadProgress.percentage = Math.min(100, this.downloadProgress.percentage + increment);
                        this.downloadProgress.downloadedMB = (this.downloadProgress.totalMB * this.downloadProgress.percentage / 100).toFixed(1);
                        this.downloadProgress.speed = (Math.random() * 3000 + 1000).toFixed(0);
                    }, 500);
                },

                closeDownload() {
                    if (this.downloadProgress.percentage < 100) {
                        if (confirm('ダウンロードを中止しますか?')) {
                            this.downloadActive = false;
                            this.formSubmitting = false;
                        }
                    } else {
                        this.downloadActive = false;
                    }
                },

                async createServer() {
                    try {
                        console.log('Creating server with data:', this.serverForm);
                        const response = await fetch('/api/servers/create', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify(this.serverForm)
                        });
                        
                        console.log('Response status:', response.status);
                        
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            const text = await response.text();
                            console.error('Non-JSON response from server:', text.substring(0, 200));
                            this.showError(`サーバーが予期しない形式の応答を返しました (Status: ${response.status})`);
                            return;
                        }
                        
                        const data = await response.json();
                        console.log('Response data:', data);
                        
                        if (data.ok) {
                            this.showSuccess(`🎉 "${this.serverForm.serverName}" が正常に作成されました!`);
                            this.resetForm();
                            await this.loadServers();
                            setTimeout(() => this.switchTab('servers'), 1500);
                        } else {
                            this.showError(data.message || 'サーバーの作成に失敗しました');
                        }
                    } catch (error) {
                        console.error('Server creation error:', error);
                        this.showError(`サーバー作成中にエラーが発生しました: ${error.message}`);
                    }
                },

                async updateServer() {
                    try {
                        const response = await fetch(`/api/servers/${this.editingServer.id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            credentials: 'include',
                            body: JSON.stringify(this.serverForm)
                        });
                        
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            const text = await response.text();
                            console.error('Non-JSON response:', text);
                            this.showError('サーバーが予期しない形式の応答を返しました');
                            return;
                        }
                        
                        const data = await response.json();
                        
                        if (data.ok) {
                            this.showSuccess(`✅ "${this.serverForm.serverName}" の設定を更新しました!`);
                            this.resetForm();
                            await this.loadServers();
                            setTimeout(() => this.switchTab('servers'), 1500);
                        } else {
                            this.showError(data.message || 'サーバーの更新に失敗しました');
                        }
                    } catch (error) {
                        console.error('Server update error:', error);
                        this.showError(`サーバー更新中にエラーが発生しました: ${error.message}`);
                    }
                },

                editServer(server) {
                    this.editingServer = server;
                    this.serverForm = {
                        serverName: server.serverName,
                        minecraftVersion: server.minecraftVersion,
                        serverSoftware: server.serverSoftware,
                        jdkVersion: server.jdkVersion
                    };
                    // Load available versions for the selected software
                    if (this.serverListData && server.serverSoftware) {
                        this.loadAvailableVersions(server.serverSoftware);
                    }
                    this.switchTab('create');
                    this.showSuccess(`${server.serverName} の編集モードに切り替えました。`);
                },

                async deleteServer(server) {
                    const confirmMessage = `本当に "${server.serverName}" を削除しますか?\n\nこの操作は取り消せません。\n- サーバー名: ${server.serverName}\n- バージョン: ${server.minecraftVersion}\n- ソフトウェア: ${server.serverSoftware}`;
                    
                    if (!confirm(confirmMessage)) return;
                    
                    try {
                        const response = await fetch(`/api/servers/${server.id}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        });
                        
                        const data = await response.json();
                        
                        if (data.ok) {
                            this.showSuccess(`🗑️ "${server.serverName}" を削除しました。`);
                            await this.loadServers();
                        } else {
                            this.showError(data.message || 'サーバーの削除に失敗しました');
                        }
                    } catch (error) {
                        this.showError('サーバー削除中にエラーが発生しました');
                    }
                },

                resetForm() {
                    this.editingServer = null;
                    this.serverForm = {
                        serverName: '',
                        minecraftVersion: '',
                        serverSoftware: '',
                        jdkVersion: ''
                    };
                    this.availableVersions = [];
                },

                switchTab(tabId) {
                    if (tabId === 'create' && this.activeTab === 'create' && this.editingServer) {
                        this.resetForm();
                    }
                    this.activeTab = tabId;
                    // Close sidebar on mobile after selection
                    if (window.innerWidth < 1024) {
                        this.closeSidebar();
                    }
                },

                async testProtectedApi() {
                    try {
                        const response = await fetch('/api/protected', {
                            credentials: 'include'
                        });
                        const data = await response.json();
                        this.apiResponse = JSON.stringify(data, null, 2);
                    } catch (error) {
                        this.apiResponse = `Error: ${error.message}`;
                    }
                },

                connectWebSocket() {
                    const wsUrl = 'ws://localhost:4000';
                    this.ws = new WebSocket(wsUrl);

                    this.ws.onopen = () => {
                        console.log('✅ WebSocket connected');
                        this.wsConnected = true;
                    };

                    this.ws.onmessage = (event) => {
                        try {
                            const message = JSON.parse(event.data);
                            this.handleWebSocketMessage(message);
                        } catch (error) {
                            console.error('Failed to parse WebSocket message:', error);
                        }
                    };

                    this.ws.onclose = () => {
                        console.log('❌ WebSocket disconnected');
                        this.wsConnected = false;
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };

                    this.ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                    };
                },

                handleWebSocketMessage(message) {
                    console.log('📨 WebSocket message:', message);

                    switch (message.type) {
                        case 'download_progress':
                            this.updateDownloadProgress(message.data);
                            break;
                        case 'download_complete':
                            this.handleDownloadComplete(message.data);
                            break;
                        case 'download_error':
                            this.handleDownloadError(message.data);
                            break;
                    }
                },

                async fetchDownloadList() {
                    if (!this.downloadListType) {
                        this.showError('リストタイプを選択してください');
                        return;
                    }

                    this.fetchingList = true;

                    try {
                        const response = await fetch(`http://localhost:4000/api/list/${this.downloadListType}`);
                        const data = await response.json();

                        if (data.success) {
                            this.downloadListData = data.data;
                            this.showSuccess('リストを取得しました');
                        } else {
                            this.showError(`エラー: ${data.error.message}`);
                        }
                    } catch (error) {
                        console.error('Failed to fetch list:', error);
                        this.showError('サーバーからのリスト取得に失敗しました');
                    } finally {
                        this.fetchingList = false;
                    }
                },

                selectFile(fileInfo) {
                    this.selectedFile = fileInfo;
                },

                async startDownload() {
                    if (!this.selectedFile) {
                        this.showError('ダウンロードするファイルを選択してください');
                        return;
                    }

                    this.startingDownload = true;

                    try {
                        const response = await fetch('http://localhost:4000/api/download', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ url: this.selectedFile.url })
                        });

                        const data = await response.json();

                        if (data.success) {
                            console.log('Download started:', data.data);
                            this.addDownload(data.data.status);
                            this.showSuccess('ダウンロードを開始しました');
                        } else {
                            this.showError(`エラー: ${data.error.message}`);
                        }
                    } catch (error) {
                        console.error('Failed to start download:', error);
                        this.showError('ダウンロードの開始に失敗しました');
                    } finally {
                        this.startingDownload = false;
                    }
                },

                addDownload(status) {
                    const existingIndex = this.activeDownloads.findIndex(d => d.taskId === status.taskId);
                    if (existingIndex === -1) {
                        this.activeDownloads.unshift(status);
                    }
                },

                updateDownloadProgress(progress) {
                    const index = this.activeDownloads.findIndex(d => d.taskId === progress.taskId);
                    if (index !== -1) {
                        this.activeDownloads[index] = progress;
                    } else {
                        this.addDownload(progress);
                    }
                },

                handleDownloadComplete(data) {
                    console.log('✅ Download completed:', data);
                    const index = this.activeDownloads.findIndex(d => d.taskId === data.taskId);
                    if (index !== -1) {
                        this.activeDownloads[index].status = 'completed';
                    }
                    this.showSuccess('ダウンロードが完了しました');
                },

                handleDownloadError(data) {
                    console.error('❌ Download error:', data);
                    const index = this.activeDownloads.findIndex(d => d.taskId === data.taskId);
                    if (index !== -1) {
                        this.activeDownloads[index].status = 'error';
                    }
                    this.showError(`ダウンロードエラー: ${data.error || '不明なエラー'}`);
                },

                async cancelDownload(taskId) {
                    try {
                        const response = await fetch(`http://localhost:4000/api/download/${taskId}`, {
                            method: 'DELETE'
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            const index = this.activeDownloads.findIndex(d => d.taskId === taskId);
                            if (index !== -1) {
                                this.activeDownloads[index].status = 'cancelled';
                            }
                            this.showSuccess('ダウンロードをキャンセルしました');
                        } else {
                            this.showError(`キャンセル失敗: ${data.error.message}`);
                        }
                    } catch (error) {
                        console.error('Error cancelling download:', error);
                        this.showError('ダウンロードのキャンセル中にエラーが発生しました');
                    }
                },

                showError(message) {
                    this.errorMessage = message;
                    setTimeout(() => {
                        this.errorMessage = '';
                    }, 5000);
                },

                showSuccess(message) {
                    this.successMessage = message;
                    setTimeout(() => {
                        this.successMessage = '';
                    }, 5000);
                },

                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('ja-JP');
                },

                formatTime(seconds) {
                    const min = Math.floor(seconds / 60);
                    const sec = Math.floor(seconds % 60);
                    return `${min}分 ${sec}秒`;
                }
            },

            template: `
                <div v-if="loading" id="loading-overlay">
                    <div class="loading-spinner"></div>
                    <p>読み込み中...</p>
                </div>

                <div v-else-if="!isAuthenticated">
                    <section v-if="authMode === 'signup'" class="auth-container">
                        <div class="auth-card">
                            <div class="auth-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="auth-header">
                                <h2>ユーザー登録</h2>
                                <p>このアプリケーションを使用するために、管理ユーザーを1名登録してください。</p>
                            </div>
                            <form @submit.prevent="handleSignup">
                                <div class="form-group">
                                    <label for="signup-id">ユーザーID</label>
                                    <input 
                                        type="text" 
                                        id="signup-id" 
                                        v-model="signupForm.id" 
                                        required
                                        placeholder="ユーザーIDを入力"
                                    >
                                </div>
                                <div class="form-group">
                                    <label for="signup-password">パスワード</label>
                                    <input 
                                        type="password" 
                                        id="signup-password" 
                                        v-model="signupForm.password" 
                                        required
                                        placeholder="パスワードを入力"
                                    >
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check-circle"></i>
                                    登録して開始
                                </button>
                                <div v-if="authMessage" :class="['message', authMessageType]">
                                    {{ authMessage }}
                                </div>
                                <p style="text-align: center; margin-top: 20px; color: var(--theme-text-secondary);">
                                    既にアカウントをお持ちの方は 
                                    <a href="#" @click.prevent="authMode = 'login'" style="color: var(--theme-primary); font-weight: 600; text-decoration: none;">
                                        こちらからログイン
                                    </a>
                                </p>
                            </form>
                        </div>
                    </section>

                    <section v-else class="auth-container">
                        <div class="auth-card">
                            <div class="auth-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="auth-header">
                                <h2>ログイン</h2>
                                <p>アカウント情報を入力してください</p>
                            </div>
                            <form @submit.prevent="handleLogin">
                                <div class="form-group">
                                    <label for="login-id">ユーザーID</label>
                                    <input 
                                        type="text" 
                                        id="login-id" 
                                        v-model="loginForm.id" 
                                        required
                                        placeholder="ユーザーIDを入力"
                                    >
                                </div>
                                <div class="form-group">
                                    <label for="login-password">パスワード</label>
                                    <input 
                                        type="password" 
                                        id="login-password" 
                                        v-model="loginForm.password" 
                                        required
                                        placeholder="パスワードを入力"
                                    >
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-sign-in-alt"></i>
                                    ログイン
                                </button>
                                <div v-if="authMessage" :class="['message', authMessageType]">
                                    {{ authMessage }}
                                </div>
                                <p style="text-align: center; margin-top: 20px; color: var(--theme-text-secondary);">
                                    アカウントをお持ちでない方は 
                                    <a href="#" @click.prevent="authMode = 'signup'" style="color: var(--theme-primary); font-weight: 600; text-decoration: none;">
                                        こちらから新規登録
                                    </a>
                                </p>
                            </form>
                        </div>
                    </section>
                </div>

                <main v-else class="main-wrapper">
                    <nav class="navbar">
                        <div class="navbar-content">
                            <div style="display: flex; align-items: center;">
                                <button @click="toggleSidebar" class="hamburger-menu">
                                    <i class="fas fa-bars"></i>
                                </button>
                                <div class="navbar-brand">
                                    <i class="fas fa-cubes"></i>
                                    Minecraft Server Manager
                                </div>
                            </div>
                            <div class="navbar-actions">
                                <button @click="toggleTheme" class="theme-toggle" :title="darkMode ? 'ライトモードに切り替え' : 'ダークモードに切り替え'">
                                    <i v-if="darkMode" class="fas fa-sun" style="font-size: 14px;"></i>
                                    <i v-else class="fas fa-moon" style="font-size: 14px;"></i>
                                </button>
                                <div class="user-menu-container" :class="{ open: userMenuOpen }" @click.stop="toggleUserMenu">
                                    <div class="user-menu">
                                        <div class="user-avatar">
                                            <i class="fas fa-user" style="font-size: 12px;"></i>
                                        </div>
                                        <span>{{ username || '管理者' }}</span>
                                        <i class="fas fa-chevron-down" style="font-size: 10px;"></i>
                                    </div>
                                    <div class="user-menu-dropdown">
                                        <div class="user-menu-item" @click="handleLogout">
                                            <i class="fas fa-sign-out-alt"></i>
                                            <span>ログアウト</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <!-- Sidebar Overlay -->
                    <div :class="['sidebar-overlay', { active: sidebarOpen }]" @click="closeSidebar"></div>

                    <!-- Sidebar -->
                    <aside :class="['sidebar', { open: sidebarOpen }]">
                        <ul class="sidebar-menu">
                            <li v-for="item in sidebarMenu" :key="item.id" class="sidebar-menu-item">
                                <button 
                                    :class="['sidebar-menu-button', { active: activeTab === item.id }]"
                                    @click="switchTab(item.id)"
                                >
                                    <i :class="item.icon"></i>
                                    <span>{{ item.label }}</span>
                                </button>
                            </li>
                        </ul>
                    </aside>

                    <div class="dashboard">
                        <div class="dashboard-header">
                            <h1 class="dashboard-title">サーバー管理ダッシュボード</h1>
                            <p class="dashboard-subtitle">Minecraftサーバーの作成、管理、監視を行います</p>
                        </div>

                        <transition name="fade">
                            <div v-if="errorMessage" class="message-area error">
                                {{ errorMessage }}
                            </div>
                        </transition>
                        <transition name="fade">
                            <div v-if="successMessage" class="message-area success">
                                {{ successMessage }}
                            </div>
                        </transition>

                        <div v-show="activeTab === 'servers'" class="content-section active">
                            <div class="section-title">
                                <i class="fas fa-server"></i>
                                Minecraftサーバー一覧
                            </div>
                            
                            <div v-if="serversLoading" class="empty-state">
                                <i class="fas fa-spinner fa-spin" style="font-size: 36px; color: var(--theme-primary);"></i>
                                <h3>サーバー一覧を読み込み中...</h3>
                                <p>少々お待ちください</p>
                            </div>

                            <div v-else-if="servers.length === 0" class="empty-state">
                                <i class="fas fa-server"></i>
                                <h3>サーバーが登録されていません</h3>
                                <p>「新規作成」タブから最初のMinecraftサーバーを追加してください。</p>
                                <button class="btn btn-primary" @click="switchTab('create')">
                                    <i class="fas fa-plus-circle"></i>
                                    サーバーを作成する
                                </button>
                            </div>

                            <div v-else class="servers-grid">
                                <div 
                                    v-for="server in servers" 
                                    :key="server.id"
                                    class="server-card"
                                >
                                    <div :class="['server-status', server.isRunning ? 'running' : 'stopped']">
                                        {{ server.isRunning ? '🟢 稼働中' : '🔴 停止中' }}
                                    </div>
                                    
                                    <div class="server-name">
                                        <i class="fas fa-cube" style="color: var(--theme-primary); margin-right: 6px; font-size: 14px;"></i>
                                        {{ server.serverName }}
                                    </div>
                                    
                                    <div class="server-details">
                                        <div class="server-detail">
                                            <span class="server-detail-label">
                                                <i class="fas fa-code-branch"></i> バージョン
                                            </span>
                                            <span class="server-detail-value">{{ server.minecraftVersion }}</span>
                                        </div>
                                        <div class="server-detail">
                                            <span class="server-detail-label">
                                                <i class="fas fa-cogs"></i> ソフトウェア
                                            </span>
                                            <span class="server-detail-value">{{ server.serverSoftware }}</span>
                                        </div>
                                        <div class="server-detail">
                                            <span class="server-detail-label">
                                                <i class="fas fa-coffee"></i> JDK
                                            </span>
                                            <span class="server-detail-value">{{ server.jdkVersion }}</span>
                                        </div>
                                        <div class="server-detail">
                                            <span class="server-detail-label">
                                                <i class="fas fa-calendar-alt"></i> 作成日
                                            </span>
                                            <span class="server-detail-value">{{ formatDate(server.createdAt) }}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="server-actions">
                                        <button class="btn btn-secondary btn-sm" @click="editServer(server)">
                                            <i class="fas fa-edit"></i>
                                            編集
                                        </button>
                                        <button class="btn btn-danger btn-sm" @click="deleteServer(server)">
                                            <i class="fas fa-trash-alt"></i>
                                            削除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-show="activeTab === 'create'" class="content-section active">
                            <div class="section-title">
                                <i class="fas fa-plus-circle"></i>
                                <span>{{ editingServer ? \`"\${editingServer.serverName}" を編集\` : '新しいMinecraftサーバーを作成' }}</span>
                            </div>
                            
                            <form @submit.prevent="handleServerSubmit">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="serverName">
                                            <i class="fas fa-tag"></i>
                                            サーバー名
                                        </label>
                                        <input 
                                            type="text" 
                                            id="serverName" 
                                            v-model="serverForm.serverName" 
                                            required
                                            placeholder="例: My Minecraft Server"
                                        >
                                    </div>
                                    <div class="form-group">
                                        <label for="serverSoftware">
                                            <i class="fas fa-cogs"></i>
                                            サーバーソフトウェアを選択
                                        </label>
                                        <select id="serverSoftware" v-model="serverForm.serverSoftware" required>
                                            <option value="">ソフトウェアを選択してください</option>
                                            <option value="vanilla">Vanilla (公式)</option>
                                            <option value="forge">Forge (Mod)</option>
                                            <option value="fabric">Fabric (軽量Mod)</option>
                                            <option value="paper">Paper (推奨)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="minecraftVersion">
                                            <i class="fas fa-code-branch"></i>
                                            Minecraftバージョンを選択
                                        </label>
                                        <select 
                                            id="minecraftVersion" 
                                            v-model="serverForm.minecraftVersion" 
                                            :disabled="!serverForm.serverSoftware || loadingVersions || availableVersions.length === 0"
                                            required
                                        >
                                            <option value="">{{ minecraftVersionPlaceholder }}</option>
                                            <option 
                                                v-for="version in availableVersions" 
                                                :key="version.version" 
                                                :value="version.version"
                                            >
                                                {{ version.version }}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="jdkVersion">
                                            <i class="fas fa-coffee"></i>
                                            JDKバージョン (自動選択)
                                        </label>
                                        <input 
                                            type="text" 
                                            id="jdkVersion" 
                                            v-model="serverForm.jdkVersion" 
                                            disabled
                                            :placeholder="serverForm.minecraftVersion ? '' : 'バージョン選択後に自動設定されます'"
                                            readonly
                                            style="background: var(--theme-bg); cursor: not-allowed;"
                                        >
                                    </div>
                                </div>
                                
                                <button type="submit" :class="['btn', editingServer ? 'btn-secondary' : 'btn-primary']" :disabled="formSubmitting">
                                    <i :class="formSubmitting ? 'fas fa-spinner fa-spin' : (editingServer ? 'fas fa-save' : 'fas fa-rocket')"></i>
                                    {{ formSubmitting ? (editingServer ? '更新中...' : 'ダウンロード & 作成中...') : (editingServer ? 'サーバーを更新' : 'サーバーを作成') }}
                                </button>
                            </form>
                        </div>

                        <div v-show="activeTab === 'settings'" class="content-section active">
                            <div class="section-title">
                                <i class="fas fa-cogs"></i>
                                システム設定
                            </div>
                            
                            <div style="background: var(--theme-bg); padding: 24px; border-radius: 16px; margin-bottom: 24px;">
                                <h4 style="color: var(--theme-text); margin-bottom: 16px; font-size: 18px;">
                                    <i class="fas fa-shield-alt" style="color: var(--theme-primary);"></i>
                                    保護されたAPI テスト
                                </h4>
                                <p style="color: var(--theme-text-secondary); margin-bottom: 20px; line-height: 1.6;">
                                    ログイン状態でのみアクセス可能なAPIエンドポイントをテストします。<br>
                                    認証システムが正常に動作していることを確認できます。
                                </p>
                                <button @click="testProtectedApi" class="btn btn-success">
                                    <i class="fas fa-flask"></i>
                                    /api/protected をテスト
                                </button>
                            </div>
                            
                            <div style="background: var(--theme-surface); border: 2px solid var(--theme-border); border-radius: 16px; padding: 20px;">
                                <h5 style="color: var(--theme-text); margin-bottom: 12px;">
                                    <i class="fas fa-terminal" style="color: var(--theme-primary);"></i>
                                    APIレスポンス
                                </h5>
                                <pre style="
                                    background: #1f2937; 
                                    color: #e5e7eb; 
                                    padding: 20px; 
                                    border-radius: 12px; 
                                    font-family: 'Monaco', 'Consolas', monospace;
                                    font-size: 14px;
                                    line-height: 1.5;
                                    white-space: pre-wrap; 
                                    word-wrap: break-word; 
                                    min-height: 60px;
                                    overflow-x: auto;
                                ">{{ apiResponse }}</pre>
                            </div>
                        </div>

                        <div v-show="activeTab === 'downloads'" class="content-section active">
                            <h2>
                                <i class="fas fa-cloud-download-alt"></i>
                                ダウンロード管理
                            </h2>
                            
                            <div class="download-section">
                                <h3><i class="fas fa-plug"></i> 接続状態</h3>
                                <div :class="['connection-badge', wsConnected ? 'connected' : 'disconnected']">
                                    <i :class="wsConnected ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
                                    {{ wsConnected ? '接続済み' : '未接続' }}
                                </div>
                                <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-top: 10px;">
                                    WebSocketサーバー (localhost:4000) への接続状態を表示しています。
                                </p>
                            </div>

                            <div class="download-section">
                                <h3><i class="fas fa-list"></i> リスト取得</h3>
                                <div class="download-control-group">
                                    <label for="downloadListType">
                                        <i class="fas fa-filter"></i>
                                        リストタイプを選択:
                                    </label>
                                    <select id="downloadListType" v-model="downloadListType">
                                        <option value="">-- タイプを選択 --</option>
                                        <option value="servers">サーバーソフトウェア</option>
                                        <option value="jdk">JDK</option>
                                    </select>
                                </div>
                                <button @click="fetchDownloadList" class="btn btn-primary" :disabled="!downloadListType || fetchingList">
                                    <i :class="fetchingList ? 'fas fa-spinner fa-spin' : 'fas fa-download'"></i>
                                    {{ fetchingList ? '読み込み中...' : 'リストを取得' }}
                                </button>

                                <div v-if="downloadListData" class="download-list-preview">
                                    <pre>{{ JSON.stringify(downloadListData, null, 2) }}</pre>
                                </div>
                            </div>

                            <div v-if="downloadListData" class="download-section">
                                <h3><i class="fas fa-code-branch"></i> バージョン選択</h3>
                                <div v-if="downloadListType === 'servers'">
                                    <div v-for="server in downloadListData" :key="server.name" style="margin-bottom: 20px;">
                                        <h4 style="margin-bottom: 10px; color: var(--theme-primary);">{{ server.name }}</h4>
                                        <div class="download-version-grid">
                                            <button
                                                v-for="version in server.versions"
                                                :key="version.version"
                                                :class="['download-version-btn', { selected: selectedFile && selectedFile.url === version.downloadUrl }]"
                                                @click="selectFile({ name: server.name, version: version.version, jdk: version.jdk, url: version.downloadUrl, type: 'server' })"
                                            >
                                                {{ version.version }} (JDK {{ version.jdk }})
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div v-else-if="downloadListType === 'jdk'">
                                    <div v-for="jdk in downloadListData" :key="jdk.version" style="margin-bottom: 20px;">
                                        <h4 style="margin-bottom: 10px; color: var(--theme-primary);">JDK {{ jdk.version }} {{ jdk.vendor ? \`(\${jdk.vendor})\` : '' }}</h4>
                                        <div class="download-version-grid">
                                            <button
                                                v-for="download in jdk.downloads"
                                                :key="download.os"
                                                :class="['download-version-btn', { selected: selectedFile && selectedFile.url === download.downloadUrl }]"
                                                @click="selectFile({ version: jdk.version, os: download.os, url: download.downloadUrl, vendor: jdk.vendor, type: 'jdk' })"
                                            >
                                                {{ download.os.toUpperCase() }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="selectedFile" class="download-section">
                                <h3><i class="fas fa-check-circle"></i> 選択されたファイル</h3>
                                <div class="download-selected-file-card">
                                    <h4>ファイル情報:</h4>
                                    <p class="download-selected-file-name">
                                        <template v-if="selectedFile.type === 'server'">
                                            {{ selectedFile.name }} {{ selectedFile.version }} (JDK {{ selectedFile.jdk }})
                                        </template>
                                        <template v-else>
                                            JDK {{ selectedFile.version }} - {{ selectedFile.os.toUpperCase() }}
                                        </template>
                                    </p>
                                    <p class="download-selected-file-url">{{ selectedFile.url }}</p>
                                    <button @click="startDownload" class="btn btn-primary" style="margin-top: 15px;" :disabled="startingDownload">
                                        <i :class="startingDownload ? 'fas fa-spinner fa-spin' : 'fas fa-download'"></i>
                                        {{ startingDownload ? 'ダウンロード開始中...' : 'ダウンロード開始' }}
                                    </button>
                                </div>
                            </div>

                            <div class="download-section">
                                <h3><i class="fas fa-tasks"></i> アクティブなダウンロード</h3>
                                <div v-if="activeDownloads.length === 0" class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <h3>ダウンロードがありません</h3>
                                    <p>上記からファイルを選択してダウンロードを開始してください。</p>
                                </div>
                                <div v-else>
                                    <div v-for="download in activeDownloads" :key="download.taskId" class="download-card">
                                        <div class="download-card-header">
                                            <div class="download-filename">
                                                <i class="fas fa-file-download"></i>
                                                {{ download.filename }}
                                            </div>
                                            <div :class="['download-status-badge', \`status-\${download.status}\`]">
                                                {{ download.status.toUpperCase() }}
                                            </div>
                                        </div>
                                        <div class="download-progress-container">
                                            <div class="download-progress-bar" :style="{ width: download.percentage + '%' }"></div>
                                        </div>
                                        <div class="download-info-grid">
                                            <div class="download-info-item">
                                                <span class="download-info-label">ダウンロード済み</span>
                                                <span class="download-info-value">
                                                    {{ (download.downloadedBytes / (1024 * 1024)).toFixed(2) }} MB / {{ (download.totalBytes / (1024 * 1024)).toFixed(2) }} MB
                                                </span>
                                            </div>
                                            <div class="download-info-item">
                                                <span class="download-info-label">速度</span>
                                                <span class="download-info-value">{{ (download.speed / 1024).toFixed(2) }} KB/s</span>
                                            </div>
                                            <div class="download-info-item">
                                                <span class="download-info-label">残り時間</span>
                                                <span class="download-info-value">
                                                    {{ download.remainingTime > 0 ? formatTime(download.remainingTime) : '--' }}
                                                </span>
                                            </div>
                                            <div class="download-info-item">
                                                <button 
                                                    v-if="download.status === 'downloading'" 
                                                    @click="cancelDownload(download.taskId)"
                                                    class="btn btn-danger btn-sm"
                                                >
                                                    <i class="fas fa-times"></i> キャンセル
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-show="activeTab === 'about'" class="content-section active">
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>
                                About Us
                            </div>
                            <div class="empty-state">
                                <i class="fas fa-info-circle"></i>
                                <h3>About Us</h3>
                                <p>このセクションは準備中です。</p>
                            </div>
                        </div>

                        <div v-show="activeTab === 'tutorials'" class="content-section active">
                            <div class="section-title">
                                <i class="fas fa-book"></i>
                                Tutorials
                            </div>
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h3>Tutorials</h3>
                                <p>このセクションは準備中です。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Download Progress Overlay for Server Creation -->
                    <div :class="['download-overlay', { active: downloadActive }]">
                        <div class="download-overlay-content">
                            <div class="download-header">
                                <div class="download-title">
                                    <i class="fas fa-download"></i>
                                    サーバーファイルをダウンロード中
                                </div>
                                <button class="download-close" @click="closeDownload" v-if="downloadProgress.percentage >= 100">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="download-info">
                                <div class="download-filename">
                                    <i class="fas fa-file"></i> {{ downloadProgress.filename }}
                                </div>
                                <div class="download-stats">
                                    <div class="download-stat">
                                        <i class="fas fa-hdd"></i>
                                        <span>{{ downloadProgress.downloadedMB }} / {{ downloadProgress.totalMB }} MB</span>
                                    </div>
                                    <div class="download-stat">
                                        <i class="fas fa-tachometer-alt"></i>
                                        <span>{{ downloadProgress.speed }} KB/s</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="download-progress-wrapper">
                                <div class="download-progress-fill" :style="{ width: downloadProgress.percentage + '%' }"></div>
                            </div>
                            <div style="text-align: center; margin-top: 8px; font-size: 13px; color: var(--theme-text-secondary); font-weight: 500;">
                                {{ downloadProgress.percentage.toFixed(0) }}%
                            </div>
                            
                            <div class="download-status">
                                <i :class="downloadProgress.percentage >= 100 ? 'fas fa-check-circle' : 'fas fa-spinner fa-spin'"></i>
                                {{ downloadProgress.status }}
                            </div>
                        </div>
                    </div>
                </main>
            `
        }).mount('#app');
    </script>
</body>
</html>